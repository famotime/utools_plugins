# 弥隙缩图 (Seamless Crop)

一个强大的 uTools 图片编辑插件，用于删除图片中的横向内容区域并自动拼接上下部分。

![版本](https://img.shields.io/badge/version-1.0.0-blue)
![平台](https://img.shields.io/badge/platform-uTools-green)

## 📖 功能简介

**弥隙缩图**是一款专门用于图片编辑的 uTools 插件，可以快速删除图片中不需要的横向区域，并自动将上下部分无缝拼接。

### 主要特性

- ✂️ **智能裁剪**：框选图片中的任意横向区域，自动扩展至图片左右边缘进行删除
- 🖱️ **便捷操作**：鼠标拖拽即可创建选区，实时预览删除效果
- ↶ **撤销功能**：支持多步撤销操作（最多10步），避免误操作
- 💾 **灵活导出**：可保存为 PNG/JPEG 文件，或直接复制到剪贴板
- ⌨️ **快捷键支持**：常用操作均支持键盘快捷键，提高效率
- 📋 **剪贴板触发**：当剪贴板包含图片时，可直接触发插件

## 🎯 使用场景

- 📸 **截图编辑**：删除截图中的多余内容（如广告条、水印区域等）
- 📄 **文档处理**：移除扫描文档中的页眉、页脚或分隔线
- 🎨 **图片拼接**：快速移除两个内容区域之间的空白或无用部分
- 🖼️ **创意设计**：制作特殊视觉效果，压缩图片纵向空间

## 🚀 安装方法

### 方法一：通过 uTools 插件市场安装（推荐）
1. 打开 uTools
2. 进入插件市场
3. 搜索"弥隙缩图"或"Seamless Crop"
4. 点击安装

### 方法二：手动安装
1. 下载插件源码或 `.upx` 安装包
2. 打开 uTools 开发者工具
3. 选择"开发"标签
4. 点击"打开插件文件夹"并将本插件复制进去
5. 在 uTools 中重新加载插件列表

## 📝 使用方法

### 启动插件

支持以下几种触发方式：

1. **关键词触发**：
   - 在 uTools 输入"弥隙缩图"
   - 在 uTools 输入"seamless crop"
   - 在 uTools 输入"myzt"（拼音缩写）
   - 在 uTools 输入"sc"（英文缩写）

2. **剪贴板图片触发**：
   - 复制任意图片到剪贴板
   - 唤起 uTools，插件会自动匹配并显示

### 编辑图片

1. **加载图片**：插件启动后会自动加载剪贴板中的图片
2. **选择区域**：
   - 在图片上按住鼠标左键并拖拽
   - 创建一个矩形选区（选区会自动横向扩展至图片边缘）
   - 松开鼠标确认选区
3. **删除并拼接**：
   - 点击"✂️ 删除选区并拼接"按钮
   - 或按键盘 `Delete` 键
   - 选区内容将被删除，下方图片自动上移拼接
4. **调整编辑**：
   - 如果不满意，点击"↶ 撤销"按钮或按 `Ctrl+Z`
   - 可以撤销最近10步操作
5. **导出结果**：
   - 点击"💾 保存图片"或按 `Ctrl+S` 保存到本地
   - 点击"📋 复制到剪贴板"或按 `Ctrl+C` 复制图片
   - 点击"🔄 重置"可恢复到原始图片

### 快捷键列表

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+Z` | 撤销上一步操作 |
| `Ctrl+S` | 保存图片到文件 |
| `Ctrl+C` | 复制图片到剪贴板 |
| `Delete` | 删除选区并拼接 |
| `Esc` | 清除当前选区 |

## 🛠️ 技术实现

### 技术栈
- **前端**：HTML5, CSS3, JavaScript (ES6+)
- **Canvas API**：用于图片渲染和像素级操作
- **后端**：Node.js + Electron API
- **平台**：uTools Plugin Framework

### 核心算法

```javascript
// 图片拼接算法伪代码
1. 获取选区的上边界 (topY) 和下边界 (bottomY)
2. 计算需要删除的高度 gapHeight = bottomY - topY
3. 创建新画布，高度 = 原图高度 - gapHeight
4. 绘制上半部分：drawImage(原图, 0, 0, width, topY, 目标: 0, 0)
5. 绘制下半部分：drawImage(原图, 0, bottomY, width, height-bottomY, 目标: 0, topY)
6. 完成拼接
```

### 项目结构

```
seamless_crop/
├── plugin.json      # 插件配置文件
├── preload.js       # Node.js 后端逻辑
├── index.html       # 主界面（包含 CSS 和 JS）
├── logo.png         # 插件图标
└── README.md        # 说明文档（本文件）
```

## 🎨 界面预览

### 主界面布局
- **左侧**：画布区域，用于显示和编辑图片
- **右侧**：控制面板，包含所有操作按钮和信息显示

### 功能区域
- **编辑操作**：删除并拼接按钮
- **历史记录**：撤销按钮
- **导出**：保存和复制按钮
- **图片信息**：实时显示图片尺寸、选区高度、处理后高度

## ⚠️ 注意事项

1. **图片格式**：
   - 输入支持：PNG、JPEG、WebP、GIF 等浏览器支持的所有格式
   - 输出默认：PNG 格式（无损压缩，适合后续编辑）
   - 保存时可选择 PNG 或 JPEG 格式

2. **性能提示**：
   - 建议处理图片尺寸不超过 10000×10000 像素
   - 超大图片可能导致内存占用增加

3. **选区要求**：
   - 选区最小高度为 5 像素
   - 选区会自动横向扩展至图片完整宽度

4. **撤销限制**：
   - 最多支持 10 步撤销操作
   - 重置图片会清空撤销历史

## 🔧 开发说明

### 本地开发

1. 克隆本仓库
2. 在 uTools 开发者工具中加载插件目录
3. 修改代码后刷新 uTools 即可看到效果

### 调试技巧

- 在 uTools 中按 `F12` 打开开发者工具
- 查看控制台日志以定位问题
- 使用 `console.log()` 输出调试信息

### 构建发布

1. 确保所有文件已正确配置
2. 使用 uTools 开发者工具打包成 `.upx` 文件
3. 提交到 uTools 插件市场

## 📄 开源协议

本项目采用 MIT 协议开源，欢迎自由使用和修改。

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

如有问题或建议，请通过以下方式联系：
- 提交 GitHub Issue
- 在 uTools 插件评论区留言

## 📝 更新日志

### v1.0.0 (2025-01-15)
- 🎉 首次发布
- ✨ 支持图片横向区域删除和拼接
- ✨ 支持撤销/重做功能
- ✨ 支持保存和复制到剪贴板
- ✨ 完整的快捷键支持

## 💡 常见问题

**Q: 为什么选区只能横向扩展？**
A: 本插件的设计目标是删除图片中的横向内容带（如广告条、分隔线等），因此选区会自动横向扩展至图片边缘。

**Q: 可以同时删除多个区域吗？**
A: 当前版本每次只能删除一个区域，但可以通过多次操作实现删除多个区域的效果。

**Q: 撤销功能可以恢复到原图吗？**
A: 可以，点击"重置"按钮即可恢复到最初加载的原始图片状态。

**Q: 支持其他操作系统吗？**
A: 理论上支持 uTools 运行的所有平台（Windows、macOS、Linux），但主要在 Windows 上测试。

## 🙏 致谢

感谢 uTools 团队提供的优秀插件开发平台！

---

**作者**: QuincyZou
**版本**: 1.0.0
**最后更新**: 2025-01-15
